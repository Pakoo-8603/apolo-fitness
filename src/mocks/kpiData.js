/**
 * Dataset semilla para los módulos de KPIs.
 *
 * Las estructuras siguen de cerca los modelos Django descritos en models.py.
 * Todo el mock opera exclusivamente en memoria, pero este archivo también se
 * usa para rehidratar `localStorage` cuando el usuario desea persistir los
 * cambios realizados desde el frontend.
 */

export const KPI_STORAGE_KEY = 'apolo-fitness:kpis:v1'

const seedTimestamp = new Date('2024-10-15T10:00:00Z')

const ventasRecords = [
  { id: 1, fecha: '2024-09-26', total: 14500, sucursal: 'Matriz', metodo_pago: 'tarjeta', cliente_tipo: 'nuevo', procesado: true },
  { id: 2, fecha: '2024-09-27', total: 9300, sucursal: 'Matriz', metodo_pago: 'efectivo', cliente_tipo: 'recurrente', procesado: true },
  { id: 3, fecha: '2024-09-28', total: 17800, sucursal: 'Norte', metodo_pago: 'transferencia', cliente_tipo: 'nuevo', procesado: true },
  { id: 4, fecha: '2024-09-29', total: 11200, sucursal: 'Matriz', metodo_pago: 'tarjeta', cliente_tipo: 'recurrente', procesado: true },
  { id: 5, fecha: '2024-09-30', total: 15400, sucursal: 'Matriz', metodo_pago: 'tarjeta', cliente_tipo: 'nuevo', procesado: true },
  { id: 6, fecha: '2024-10-01', total: 20400, sucursal: 'Norte', metodo_pago: 'tarjeta', cliente_tipo: 'recurrente', procesado: true },
  { id: 7, fecha: '2024-10-02', total: 12600, sucursal: 'Matriz', metodo_pago: 'efectivo', cliente_tipo: 'nuevo', procesado: true },
  { id: 8, fecha: '2024-10-03', total: 9600, sucursal: 'Matriz', metodo_pago: 'transferencia', cliente_tipo: 'nuevo', procesado: true },
  { id: 9, fecha: '2024-10-04', total: 18800, sucursal: 'Norte', metodo_pago: 'tarjeta', cliente_tipo: 'recurrente', procesado: true },
  { id: 10, fecha: '2024-10-05', total: 16300, sucursal: 'Matriz', metodo_pago: 'tarjeta', cliente_tipo: 'recurrente', procesado: true },
  { id: 11, fecha: '2024-10-06', total: 10100, sucursal: 'Matriz', metodo_pago: 'efectivo', cliente_tipo: 'nuevo', procesado: true },
  { id: 12, fecha: '2024-10-07', total: 22100, sucursal: 'Norte', metodo_pago: 'tarjeta', cliente_tipo: 'recurrente', procesado: true },
  { id: 13, fecha: '2024-10-08', total: 17200, sucursal: 'Matriz', metodo_pago: 'transferencia', cliente_tipo: 'recurrente', procesado: true },
  { id: 14, fecha: '2024-10-09', total: 9500, sucursal: 'Matriz', metodo_pago: 'efectivo', cliente_tipo: 'nuevo', procesado: true },
  { id: 15, fecha: '2024-10-10', total: 18400, sucursal: 'Norte', metodo_pago: 'tarjeta', cliente_tipo: 'nuevo', procesado: true },
  { id: 16, fecha: '2024-10-11', total: 13700, sucursal: 'Matriz', metodo_pago: 'tarjeta', cliente_tipo: 'recurrente', procesado: true },
  { id: 17, fecha: '2024-10-12', total: 9900, sucursal: 'Matriz', metodo_pago: 'efectivo', cliente_tipo: 'nuevo', procesado: true },
  { id: 18, fecha: '2024-10-13', total: 20900, sucursal: 'Norte', metodo_pago: 'tarjeta', cliente_tipo: 'recurrente', procesado: true },
  { id: 19, fecha: '2024-10-14', total: 11800, sucursal: 'Matriz', metodo_pago: 'transferencia', cliente_tipo: 'nuevo', procesado: true },
  { id: 20, fecha: '2024-10-15', total: 19500, sucursal: 'Norte', metodo_pago: 'tarjeta', cliente_tipo: 'recurrente', procesado: true },
  { id: 21, fecha: '2024-10-16', total: 17650, sucursal: 'Matriz', metodo_pago: 'tarjeta', cliente_tipo: 'recurrente', procesado: true },
  { id: 22, fecha: '2024-10-17', total: 14200, sucursal: 'Norte', metodo_pago: 'efectivo', cliente_tipo: 'nuevo', procesado: true },
  { id: 23, fecha: '2024-10-18', total: 20550, sucursal: 'Matriz', metodo_pago: 'transferencia', cliente_tipo: 'recurrente', procesado: true },
  { id: 24, fecha: '2024-10-19', total: 16780, sucursal: 'Norte', metodo_pago: 'tarjeta', cliente_tipo: 'nuevo', procesado: true },
  { id: 25, fecha: '2024-10-20', total: 15840, sucursal: 'Matriz', metodo_pago: 'tarjeta', cliente_tipo: 'recurrente', procesado: true },
]

const accesosRecords = [
  { id: 1, fecha: '2024-10-01T07:02:00', sucursal: 'Matriz', tipo_acceso: 'entrada' },
  { id: 2, fecha: '2024-10-01T07:35:00', sucursal: 'Matriz', tipo_acceso: 'entrada' },
  { id: 3, fecha: '2024-10-01T17:40:00', sucursal: 'Matriz', tipo_acceso: 'salida' },
  { id: 4, fecha: '2024-10-02T06:55:00', sucursal: 'Norte',  tipo_acceso: 'entrada' },
  { id: 5, fecha: '2024-10-02T18:10:00', sucursal: 'Norte',  tipo_acceso: 'salida' },
  { id: 6, fecha: '2024-10-02T18:32:00', sucursal: 'Norte',  tipo_acceso: 'salida' },
  { id: 7, fecha: '2024-10-03T07:20:00', sucursal: 'Matriz', tipo_acceso: 'entrada' },
  { id: 8, fecha: '2024-10-03T19:15:00', sucursal: 'Matriz', tipo_acceso: 'salida' },
  { id: 9, fecha: '2024-10-04T06:45:00', sucursal: 'Norte',  tipo_acceso: 'entrada' },
  { id: 10, fecha: '2024-10-04T08:12:00', sucursal: 'Norte', tipo_acceso: 'entrada' },
  { id: 11, fecha: '2024-10-04T19:02:00', sucursal: 'Norte', tipo_acceso: 'salida' },
  { id: 12, fecha: '2024-10-05T07:05:00', sucursal: 'Matriz', tipo_acceso: 'entrada' },
  { id: 13, fecha: '2024-10-05T08:48:00', sucursal: 'Matriz', tipo_acceso: 'entrada' },
  { id: 14, fecha: '2024-10-05T18:11:00', sucursal: 'Matriz', tipo_acceso: 'salida' },
  { id: 15, fecha: '2024-10-06T09:40:00', sucursal: 'Matriz', tipo_acceso: 'entrada' },
  { id: 16, fecha: '2024-10-06T20:15:00', sucursal: 'Matriz', tipo_acceso: 'salida' },
  { id: 17, fecha: '2024-10-14T07:10:00', sucursal: 'Matriz', tipo_acceso: 'entrada' },
  { id: 18, fecha: '2024-10-14T08:25:00', sucursal: 'Matriz', tipo_acceso: 'entrada' },
  { id: 19, fecha: '2024-10-14T18:45:00', sucursal: 'Matriz', tipo_acceso: 'salida' },
  { id: 20, fecha: '2024-10-15T06:50:00', sucursal: 'Norte', tipo_acceso: 'entrada' },
  { id: 21, fecha: '2024-10-15T07:05:00', sucursal: 'Norte', tipo_acceso: 'entrada' },
  { id: 22, fecha: '2024-10-15T19:05:00', sucursal: 'Norte', tipo_acceso: 'salida' },
  { id: 23, fecha: '2024-10-16T07:20:00', sucursal: 'Matriz', tipo_acceso: 'entrada' },
  { id: 24, fecha: '2024-10-16T19:18:00', sucursal: 'Matriz', tipo_acceso: 'salida' },
  { id: 25, fecha: '2024-10-17T07:08:00', sucursal: 'Norte', tipo_acceso: 'entrada' },
  { id: 26, fecha: '2024-10-17T18:55:00', sucursal: 'Norte', tipo_acceso: 'salida' },
  { id: 27, fecha: '2024-10-18T06:58:00', sucursal: 'Matriz', tipo_acceso: 'entrada' },
  { id: 28, fecha: '2024-10-18T20:02:00', sucursal: 'Matriz', tipo_acceso: 'salida' },
  { id: 29, fecha: '2024-10-19T08:12:00', sucursal: 'Norte', tipo_acceso: 'entrada' },
  { id: 30, fecha: '2024-10-19T12:47:00', sucursal: 'Norte', tipo_acceso: 'salida' },
  { id: 31, fecha: '2024-10-20T09:22:00', sucursal: 'Matriz', tipo_acceso: 'entrada' },
  { id: 32, fecha: '2024-10-20T13:50:00', sucursal: 'Matriz', tipo_acceso: 'salida' },
]

const altasPlanRecords = [
  { id: 1, fecha_alta: '2024-09-29', importe: 8200, plan_tipo: 'mensual', sucursal: 'Matriz' },
  { id: 2, fecha_alta: '2024-10-02', importe: 5600, plan_tipo: 'semanal', sucursal: 'Matriz' },
  { id: 3, fecha_alta: '2024-10-04', importe: 9600, plan_tipo: 'mensual', sucursal: 'Norte' },
  { id: 4, fecha_alta: '2024-10-08', importe: 7800, plan_tipo: 'mensual', sucursal: 'Matriz' },
  { id: 5, fecha_alta: '2024-10-12', importe: 10400, plan_tipo: 'anual', sucursal: 'Norte' },
  { id: 6, fecha_alta: '2024-10-16', importe: 6400, plan_tipo: 'mensual', sucursal: 'Matriz' },
  { id: 7, fecha_alta: '2024-10-18', importe: 11200, plan_tipo: 'mensual', sucursal: 'Norte' },
  { id: 8, fecha_alta: '2024-10-19', importe: 7200, plan_tipo: 'semanal', sucursal: 'Matriz' },
]

export function buildSeedData () {
  return {
    generated_at: seedTimestamp.toISOString(),
    sources: [
      {
        id: 1,
        empresa_id: 1,
        code: 'ventas',
        name: 'Ventas',
        description: 'Ventas registradas en el punto de venta del gimnasio.',
        content_type: 'ventas.Venta',
        default_date_field_name: 'fecha',
        base_filters: { procesado: true },
        metadata: { currency: 'MXN', sample_records: 'ventas' },
        is_template: false,
      },
      {
        id: 2,
        empresa_id: 1,
        code: 'accesos',
        name: 'Accesos',
        description: 'Entradas y salidas de clientes en las sucursales.',
        content_type: 'planes.Acceso',
        default_date_field_name: 'fecha',
        base_filters: {},
        metadata: { },
        is_template: false,
      },
      {
        id: 3,
        empresa_id: null,
        code: 'altas_plan',
        name: 'Altas de plan (plantilla)',
        description: 'Plantilla reutilizable para conversiones de membresías.',
        content_type: 'planes.AltaPlan',
        default_date_field_name: 'fecha_alta',
        base_filters: {},
        metadata: { sample_records: 'altas' },
        is_template: true,
      },
    ],
    sourceFields: [
      { id: 1, source_id: 1, name: 'total', label: 'Total de la venta', field_type: 'numeric', allowed_aggregations: ['sum', 'avg', 'max', 'min'], metadata: { currency: 'MXN' }, order: 1, is_default: true },
      { id: 2, source_id: 1, name: 'fecha', label: 'Fecha de venta', field_type: 'date', allowed_aggregations: [], metadata: {}, order: 2, is_default: true },
      { id: 3, source_id: 1, name: 'sucursal', label: 'Sucursal', field_type: 'dimension', allowed_aggregations: [], metadata: {}, order: 3, is_default: true },
      { id: 4, source_id: 1, name: 'metodo_pago', label: 'Método de pago', field_type: 'dimension', allowed_aggregations: [], metadata: {}, order: 4, is_default: false },
      { id: 5, source_id: 2, name: 'fecha', label: 'Fecha de acceso', field_type: 'date', allowed_aggregations: [], metadata: {}, order: 1, is_default: true },
      { id: 6, source_id: 2, name: 'sucursal', label: 'Sucursal', field_type: 'dimension', allowed_aggregations: [], metadata: {}, order: 2, is_default: true },
      { id: 7, source_id: 2, name: 'tipo_acceso', label: 'Tipo de acceso', field_type: 'dimension', allowed_aggregations: [], metadata: {}, order: 3, is_default: false },
      { id: 8, source_id: 3, name: 'fecha_alta', label: 'Fecha de alta', field_type: 'date', allowed_aggregations: [], metadata: {}, order: 1, is_default: true },
      { id: 9, source_id: 3, name: 'plan_tipo', label: 'Tipo de plan', field_type: 'dimension', allowed_aggregations: [], metadata: {}, order: 2, is_default: true },
      { id: 10, source_id: 3, name: 'importe', label: 'Importe', field_type: 'numeric', allowed_aggregations: ['sum', 'avg', 'max', 'min'], metadata: { currency: 'MXN' }, order: 3, is_default: true },
    ],
    metrics: [
      {
        id: 1,
        empresa_id: 1,
        code: 'ventas_mensuales',
        name: 'Ingresos mensuales',
        description: 'Suma de ventas procesadas durante el mes en curso.',
        source_id: 1,
        aggregation: 'sum',
        value_field_id: 1,
        date_field_id: 2,
        time_window: 'this_month',
        custom_start: null,
        custom_end: null,
        compare_against_previous: true,
        extra_config: { currency: 'MXN' },
        order: 1,
        is_template: false,
      },
      {
        id: 2,
        empresa_id: 1,
        code: 'ventas_por_metodo',
        name: 'Ventas por método de pago',
        description: 'Suma de ventas agrupadas por método de pago.',
        source_id: 1,
        aggregation: 'sum',
        value_field_id: 1,
        date_field_id: 2,
        time_window: 'last_30_days',
        custom_start: null,
        custom_end: null,
        compare_against_previous: false,
        extra_config: { currency: 'MXN' },
        order: 2,
        is_template: false,
      },
      {
        id: 3,
        empresa_id: 1,
        code: 'accesos_diarios',
        name: 'Accesos diarios',
        description: 'Conteo de accesos por día.',
        source_id: 2,
        aggregation: 'count',
        value_field_id: null,
        date_field_id: 5,
        time_window: 'this_week',
        custom_start: null,
        custom_end: null,
        compare_against_previous: false,
        extra_config: {},
        order: 3,
        is_template: false,
      },
      {
        id: 4,
        empresa_id: null,
        code: 'altas_plan_template',
        name: 'Altas de plan (últimos 30 días)',
        description: 'Plantilla de conteo de altas para clonar en nuevas empresas.',
        source_id: 3,
        aggregation: 'count',
        value_field_id: null,
        date_field_id: 8,
        time_window: 'last_30_days',
        custom_start: null,
        custom_end: null,
        compare_against_previous: false,
        extra_config: {},
        order: 1,
        is_template: true,
      },
    ],
    metricFilters: [
      { id: 1, metric_id: 1, field_id: 1, operator: 'gt', value: 0, connector: 'and', order: 1 },
      { id: 2, metric_id: 2, field_id: 4, operator: 'not_in', value: ['cortesia'], connector: 'and', order: 1 },
    ],
    metricDimensions: [
      { id: 1, metric_id: 2, field_id: 4, granularity: 'exact', limit: 6, order: 1 },
      { id: 2, metric_id: 3, field_id: 6, granularity: 'exact', limit: 10, order: 1 },
      { id: 3, metric_id: 3, field_id: 5, granularity: 'day', limit: null, order: 2 },
    ],
    definitions: [
      {
        id: 1,
        empresa_id: 1,
        code: 'kpi_ingresos_mes',
        name: 'Ingresos del mes',
        description: 'Visualiza la suma total de ingresos del mes en curso.',
        calculation_type: 'metric',
        metric_id: 1,
        expression: '',
        format_type: 'currency',
        baseline_metric_id: null,
        extra_config: { icon: 'fa-coins' },
        is_template: false,
      },
      {
        id: 2,
        empresa_id: 1,
        code: 'kpi_ventas_metodo',
        name: 'Ventas por método de pago',
        description: 'Distribución de ventas por método de pago.',
        calculation_type: 'metric',
        metric_id: 2,
        expression: '',
        format_type: 'value',
        baseline_metric_id: null,
        extra_config: { icon: 'fa-credit-card' },
        is_template: false,
      },
      {
        id: 3,
        empresa_id: 1,
        code: 'kpi_accesos_diarios',
        name: 'Accesos diarios',
        description: 'Conteo diario de accesos a las sucursales.',
        calculation_type: 'metric',
        metric_id: 3,
        expression: '',
        format_type: 'value',
        baseline_metric_id: null,
        extra_config: { icon: 'fa-person-walking' },
        is_template: false,
      },
      {
        id: 4,
        empresa_id: 1,
        code: 'kpi_ticket_promedio',
        name: 'Ticket promedio',
        description: 'Promedio de ingresos por acceso registrado.',
        calculation_type: 'formula',
        metric_id: null,
        expression: 'ingresos / Math.max(accesos, 1)',
        format_type: 'currency',
        baseline_metric_id: 1,
        extra_config: { decimals: 2 },
        is_template: false,
      },
      {
        id: 5,
        empresa_id: null,
        code: 'kpi_altas_template',
        name: 'Altas de planes (plantilla)',
        description: 'Plantilla de conteo de altas recientes.',
        calculation_type: 'metric',
        metric_id: 4,
        expression: '',
        format_type: 'value',
        baseline_metric_id: null,
        extra_config: {},
        is_template: true,
      },
    ],
    definitionMetrics: [
      { id: 1, definition_id: 4, metric_id: 1, alias: 'ingresos', order: 1 },
      { id: 2, definition_id: 4, metric_id: 3, alias: 'accesos', order: 2 },
    ],
    dashboards: [
      {
        id: 1,
        empresa_id: 1,
        owner_id: 1,
        name: 'Dirección General',
        slug: 'principal',
        description: 'Indicadores clave de operación y ventas.',
        is_default: true,
        layout: { columns: 12, rowHeight: 120 },
      },
      {
        id: 2,
        empresa_id: null,
        owner_id: null,
        name: 'Plantilla Comercial',
        slug: 'template-comercial',
        description: 'Dashboard base para nuevas empresas.',
        is_default: false,
        layout: { columns: 12, rowHeight: 100 },
      },
    ],
    widgets: [
      {
        id: 1,
        dashboard_id: 1,
        definition_id: 1,
        title: 'Ingresos',
        subtitle: 'Mes en curso',
        order: 1,
        size: { w: 4, h: 2 },
        position: { x: 0, y: 0 },
        time_window_override: '',
        custom_start_override: null,
        custom_end_override: null,
        options: { visualization: 'kpi', accent: 'emerald' },
      },
      {
        id: 2,
        dashboard_id: 1,
        definition_id: 2,
        title: 'Métodos de pago',
        subtitle: 'Últimos 30 días',
        order: 2,
        size: { w: 4, h: 3 },
        position: { x: 4, y: 0 },
        time_window_override: 'last_30_days',
        custom_start_override: null,
        custom_end_override: null,
        options: { visualization: 'pie', palette: 'teal' },
      },
      {
        id: 3,
        dashboard_id: 1,
        definition_id: 3,
        title: 'Accesos por día',
        subtitle: 'Semana en curso',
        order: 3,
        size: { w: 4, h: 3 },
        position: { x: 8, y: 0 },
        time_window_override: 'this_week',
        custom_start_override: null,
        custom_end_override: null,
        options: { visualization: 'line', smooth: true },
      },
      {
        id: 4,
        dashboard_id: 1,
        definition_id: 4,
        title: 'Ticket promedio',
        subtitle: 'vs mes anterior',
        order: 4,
        size: { w: 4, h: 2 },
        position: { x: 0, y: 2 },
        time_window_override: '',
        custom_start_override: null,
        custom_end_override: null,
        options: { visualization: 'kpi', accent: 'amber' },
      },
    ],
    widgetFilters: [
      {
        id: 1,
        widget_id: 2,
        field_id: 3,
        operator: 'in',
        value: ['Matriz', 'Norte'],
        connector: 'and',
        target_alias: '',
        order: 1,
      },
    ],
    sourceSamples: {
      ventas: ventasRecords,
      accesos: accesosRecords,
      altas: altasPlanRecords,
    },
  }
}

export function cloneSeedData () {
  return JSON.parse(JSON.stringify(buildSeedData()))
}
